# MySQL 优化 #
记录学习 MySQL 优化的笔记，方便复习。

## MySQL 工作原理 ##
mysql工作原理：连接请求->连接池存储->服务管理器等功能处理->SQL接口调用->解析SQL语句并预处理->执行和优化查询->读取缓存或字节流写入->按照引擎对文件进行操作。


mysql工作原理图：
![mysql原理](https://i.imgur.com/3c2o0MO.png)


SQL执行过程示意：
![SQL执行](https://i.imgur.com/gTDysEh.png)

## MySQL事务处理 ##
保证操作的一致性。典型案例：支付订单，优惠卷等。当执行事务操作，会对当前操作表加锁，防止其它影响。(分布式事务)

### 事务特性：(ACID) ###

- 原子性(A atomicity)：当成一个最小单元来处理，要么全部成功，失败全部回滚
- 一致性(C consistency)：执行一个操作（崩溃），则数据操作不成功，回滚不被破坏；—— 不好影响数据库的完整性约束
- **隔离性**(I isolation)：类似面向对象编程，对A的操作不会影响B，但两者之间可通信；—— 事务之间的行为不相互影响
- 持久性(D durability)：mysql5.7 增加持久性一样，保存到磁盘，系统崩溃，事务不会出现问题；—— 将提交的事务持久化到磁盘，数据不会丢失

mysql数据库控制台重要操作：

1. start transaction //开始事务
2. savepoint 保存点名 //设置保存点 --> 可以指定
3. rollback to 保存点名 //回滚到保存点
4. rollback //取消全部事务
5. commit // 提交事务

### 事务隔离级别 ###
隔离级别：制定一些规则，限定事务的内外那些改变的可见度（可见和不可见）。不隔离：脏读(不是真实数据)，不可重复读(事务不完结，下一个无法进行， --修改)，幻读(虚读， --插入)：

1. 读未提交  -- 脏读|不可重复读|幻读  --> 事务 A 对数据进行的修改，A 没提交，对 B 也是可见的
2. 读已提交  -- x  |不可重复读|幻读   --> 事务 A 开启，读 C=100，事务 B 开启，C=200，B 提交；A再次读取，可以获取最新数据。 （默认级别）
3. 可重复读  -- x  |  x | 幻读       --> 事务 A 开启，读 C=100， 事务 B 开启，C=200，B提交；这个动作 A 无法看，所以产生幻读 (mysql默认级别) -- P.S. mysql5.7 innodb 不会存在幻读情况
4. 可串行化  -- x  |  x | x         --> 用到大量的锁操作，每一行数据都需要加锁，性能比较差。eg. 事务 A 完毕后 B才能执行。

级别越高，要求的性能也就越高，根据业务精确度决定隔离级别。

并发的情况下如何制定隔离级别？可重复读级别 (repeatable read)

mysql 操作：（要关闭事务自动提交）

	SELECT @@tx_isolation // 查看当前隔离级别

